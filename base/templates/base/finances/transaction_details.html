{% extends 'main.html' %} {% load static %} {% block content %}
<div class="w-full max-w-7xl mx-auto flex flex-col justify-between gap-4">
  <a
    id="back-button"
    class="w-fit px-3 py-2 text-white bg-green-700 hover:bg-green-900 rounded-lg transition-all duration-300"
    href="#"
    >&larr;</a
  >
  <!--  -->
  <div class="w-full grid md:grid-cols-2 gap-4">
    <div
      class="p-3 w-full bg-green-200 rounded-2xl flex flex-col lg:flex-row items-center gap-4"
    >
      {% if not curr_obj.image %}
      <img
        class="h-40 w-40 bg-white rounded-full object-cover"
        src="{% static 'imgs/anon.png' %}"
        alt="image"
      />
      {% else %}
      <img
        class="h-40 w-40 bg-white rounded-full object-cover"
        src="{{curr_obj.image.url}}"
        alt="image"
      />
      {% endif %}
      <article class="text-gray-700 grid gap-1 w-full">
        <h4 class="text-black text-2xl font-bold">{{curr_obj.name}}</h4>
        <p>
          <i class="fa-solid fa-briefcase text-gray-800 mr-3"></i> Type :
          <span class="text-black"> {{curr_obj.get_entity_type_display}} </span>
        </p>
        <p>
          <i class="fa-solid fa-phone text-gray-800 mr-3"></i> N° de telephone :
          <span class="text-black">{{curr_obj.phone}} </span>
        </p>
        <p>
          <i class="fa-solid fa-envelope-open text-gray-800 mr-3"></i> Email :
          <span class="text-black">{{curr_obj.email}} </span>
        </p>
        <p>
          <i class="fa-solid fa-location-dot text-gray-800 mr-3"></i> Adresse :
          <span class="text-black">{{curr_obj.address}} </span>
        </p>
      </article>
    </div>

    <div class="h-full bg-orange-200 mb-4 p-4 rounded-2xl text-base grid gap-4">
      <span>Achats : <b>{{ purchases|length }}</b></span>
      <span>Retours : <b>{{ returned|length }}</b></span>
      <span>Dons : <b>{{ gifts|length }}</b></span>
    </div>
  </div>

  <section class="flex flex-col gap-4">
    <h3 class="font-bold text-lg">Liste des produits</h3>

    <!-- sale items -->
    <table id="items_table" class="w-full text-left db-table">
      <thead class="bg-green-700 border border-green-900 text-white">
        <tr>
          <th class="px-3 py-4 text-sm">Image</th>
          <th class="px-3 py-4 text-sm">Article</th>
          <th class="px-3 py-4 text-sm">Prix unitaire</th>
          <th class="px-3 py-4 text-sm text-center">Quantité</th>
          <th class="px-3 py-4 text-sm text-center">Total</th>
        </tr>
      </thead>

      <tbody class="border">
        {% for obj in transaction_items %}
        <tr
          class="text-gray-600 border text-sm hover:bg-white hover:text-black transition-all duration-300"
        >
          <td class="px-3 py-1">
            {% if obj.product_stock.product.image %}
            <img
              class="h-7 text-gray-200"
              src="{{obj.product_stock.product.image.url}}"
              alt="item image"
            />
            {% else %}
            <img
              class="h-7 text-gray-200"
              src="{% static 'imgs/logo.png' %}"
              alt="image"
            />
            {% endif %}
          </td>
          <td class="px-3 py-1">{{obj.product_stock.product.name}}</td>
          {% if obj.product_stock.is_promoted %}
          <td class="px-3 py-1">
            {{obj.product_stock.promo_price}} CFA/
            <!--  -->
            {{ obj.product_stock.product.get_unit_display }}
          </td>
          {% else %}
          <td class="px-3 py-1">
            {{ obj.product_stock.price }} CFA/
            <!--  -->
            {{ obj.product_stock.product.get_unit_display }}
          </td>
          {% endif %}
          <td class="px-3 py-1 text-center">
            {{ obj.quantity }}
            <!--  -->
            {{ obj.product_stock.product.get_unit_display }}
          </td>
          <td class="px-3 py-1 text-center">{{ obj.get_total }} CFA</td>
        </tr>
        <input type="hidden" id="csrf_token" value="{{ csrf_token }}" />
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>

<script>
  //  tabs control ----------------------------------------------------------------------------------------------------
  document.getElementById("defaultTab").click();
  function openTab(event, tabName) {
    var i, tabcontent, tabBtn;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tabBtn = document.getElementsByClassName("tabBtn");
    for (i = 0; i < tabBtn.length; i++) {
      tabBtn[i].className = tabBtn[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    event.currentTarget.className += " active";
    var minitabs = document.getElementsByClassName("minitabcontent");
    if (minitabs.length != 0) {
      minitabs = tabcontent.children;
    }
  }
</script>
{% endblock %}
