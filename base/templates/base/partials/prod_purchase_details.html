{% extends 'main.html' %} {% load static %} {% block content %}

<div class="flex flex-col gap-4">
  <div
    class="p-6 bg-green-100 rounded-3xl h-full w-full max-w-7xl mx-auto flex flex-col justify-between gap-6"
  >
    <div class="flex justify-between items-center">
      <a
        id="back-button"
        class="inline-block px-3 py-2 text-white bg-green-700 hover:bg-green-900 rounded-lg transition-all duration-300"
        href="#"
        >&larr;
      </a>

      <div
        class="flex items-center gap-4 px-3 py-2 rounded-xl bg-green-300 text-black"
      >
        <i class="fa-solid fa-receipt"></i>Achat N°-<b>000-{{ curr_obj.id}}</b>
        <button
          hx-target="#basic_dialog"
          hx-get="{% url 'edit_product_purchase' curr_obj.id %}"
          class="w-fit bg-lime-200 hover:bg-lime-300 text-xs px-4 py-2 rounded-lg transition duration-200 ease-in"
        >
          <i class="fa-solid fa-pen-to-square"></i>
        </button>
      </div>
    </div>

    <div class="w-full flex flex-col gap-2">
      <h2 class="text-4xl font-bold text-black">{{curr_obj.label}}</h2>

      <p><b>Fournisseur : </b> {{curr_obj.supplier.name }}</p>
      <p><b>Caisse : </b> {{curr_obj.cashdesk.name }}</p>
      <p>
        <b>Moyen de paiement : </b> {{curr_obj.get_payment_option_display }}
      </p>
      <p>
        <b>Status du paiement : </b> {{curr_obj.get_payment_status_display }}
      </p>
      <p><b>Total à payé : </b> {{curr_obj.total }} Cfa</p>
      <p><b>Montant payé : </b> {{curr_obj.amount_paid }} Cfa</p>
      <p><b>Montant dû : </b> {{ amount_due }} Cfa</p>
      <!-- <p><b>Description : </b> {{curr_obj.description }}</p> -->

      <div class="w-full flex flex-col gap-2">
        <h2 class="text-4xl font-bold text-black">{{curr_obj.date}}</h2>

        {% include 'base/partials/purchase_formset.html' %}
      </div>
    </div>
  </div>

  <div class="mb-20 flex flex-col gap-2">
    <b>Liste des produits</b>
      <table id="items_table" class="w-full text-left db-table">
        <thead class="bg-green-700 border border-green-900 text-white">
          <tr>
            <th class="px-3 py-4 text-sm">Image</th>
            <th class="px-3 py-4 text-sm">Article</th>
            <th class="px-3 py-4 text-sm">Prix unitaire</th>
            <th class="px-3 py-4 text-sm text-center">Quantité</th>
            <th class="px-3 py-4 text-sm text-center">Total</th>
            <th class="px-3 py-4 text-sm text-center">Actions</th>
          </tr>
        </thead>

        <tbody class="border">
          {% for obj in purchase_items %}
          <tr
            class="text-gray-600 border text-sm hover:bg-white hover:text-black transition-all duration-300"
          >
            <td class="px-3 py-1">
              {% if obj.product_stock.product.image %}
              <img
                class="h-7 text-gray-200"
                src="{{obj.product_stock.product.image.url}}"
                alt="item image"
              />
              {% else %}
              <img
                class="h-7 text-gray-200"
                src="{% static 'imgs/logo.png' %}"
                alt="image"
              />
              {% endif %}
            </td>
            <td class="px-3 py-1">{{obj.product_stock.product.name}}</td>

            <td class="px-3 py-1">
              {{ obj.product_stock.price }} Cfa/
              <!--  -->
              {{ obj.product_stock.product.get_unit_display }}
            </td>
            <td class="px-3 py-1 text-center">
              {{ obj.quantity }}
              <!--  -->
              {{ obj.product_stock.product.get_unit_display }}
            </td>
            <td class="px-3 py-1 text-center">{{ obj.get_total }} Cfa</td>
                  <td class="px-3 py-1 text-center relative">
        <div
          class="w-fit flex gap-3 justify-end items-end text-end text-gray-700 mx-auto"
        >
          <button
            type="button"
            class="hover:bg-white hover:text-green-500 px-3 py-1 rounded-full"
            name="sentry"
            onclick="toggleMenu(this,'menu_{{obj.id}}')"
          >
            <i class="fa-sharp fa-solid fa-ellipsis-vertical"></i>
          </button>

          <div
            class="hidden z-30 bg-gray-50 w-40 shadow-md lg:w-[180px] p-2 absolute right-0 top-12 origin-top-left bg-white z-10 rounded-xl flex flex-col items-center gap-2 text-xs lg:text-sm overflow-hidden"
            id="menu_{{obj.id}}"
          >
            <!--  -->
            <a
              href="{% url 'sale_details' obj.id %}"
              class="px-3 py-1 flex items-center hover:text-black hover:bg-green-200 rounded-lg w-full text-center cursor-pointer"
            >
              <i class="text-sm fa-solid fa-expand mr-2"></i>
              Détails
            </a>

            <button
              onclick="hide_dialogs()"
              hx-target="#basic_dialog"
              hx-delete="{% url 'delete_base_object' obj.id 'Sale' %}"
              hx-confirm="Voulez vous vraiment suprimmer ceci?"
              class="px-3 py-1 flex items-center hover:text-black hover:bg-red-200 rounded-lg w-full text-center cursor-pointer"
            >
              <i class="text-sm fa-solid fa-trash mr-2"></i>
              Supprimer
            </button>
          </div>
        </div>
      </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
  </div>
</div>
{% endblock %}
